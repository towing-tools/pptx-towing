# PPTX生成手順書 (Procedure)

**このファイルは必須参照です。スライド生成時は必ずこの手順に従ってください。**

---

## 設計思想：段階的参照システム

このドキュメントシステムは以下の設計思想に基づいています：

1. **このprocedure.mdのみを読めば作業を開始できる**
2. **各フェーズで必要になった時点で、該当する枝葉ドキュメントを参照する**
3. **不要なドキュメントは読まなくてよい（コンテキストの節約）**

### ドキュメント構成

| ファイル | 内容 | 参照タイミング |
|---------|------|--------------|
| `procedure.md`（本ファイル） | 作業手順、核心原則 | **常に最初に参照** |
| `templates.md` | スライドテンプレート集 | Phase 2: Content作成時 |
| `content-guide.md` | コンテンツ密度、メッセージ設計 | Phase 2: Content作成時 |
| `config-reference.md` | theme_config.jsonの詳細 | デザイン調整が必要な時 |
| `troubleshooting.md` | エラー対処法 | エラー発生時 |

---

## 核心原則：デザインと内容の分離

- **Design（憲法）**: `assets/theme_config.json` が唯一の正解
- **Content（自由）**: Markdownファイルで構造と内容を記述
- **Pipeline（執行）**: 指定スクリプトを使用、手作業XML編集は禁止

---

## 【最重要】フォルダ構造ルール

**スライド生成時は必ず専用フォルダを作成してください。**

### フォルダ作成手順

```bash
# 1. outputディレクトリにプロジェクトフォルダを作成
mkdir -p pptx-towing-v3/output/<project_name>/slides

# 例: 2026年度事業計画のスライド
mkdir -p pptx-towing-v3/output/2026_business_plan/slides
```

### 必須フォルダ構造

```
pptx-towing-v3/output/<project_name>/
├── outline.md           # Phase 1: アウトライン
├── content.md           # Phase 2: 詳細コンテンツ
├── slides/              # 中間HTMLファイル格納
│   ├── slide_1.html
│   ├── slide_2.html
│   └── ...
├── intermediate.pptx    # Phase 3: 中間PPTX
└── final.pptx           # Phase 4: 最終成果物
```

### ファイル命名規則

- プロジェクト名は英数字とアンダースコアのみ使用
- 日付を含める場合: `YYYY_MM_project_name`
- 例: `2026_01_quarterly_report`, `investor_pitch_v2`

---

## 言語指定ルール

**スライドの言語は必ずユーザーに確認してください。**

### 確認すべき事項

1. **主要言語**: 日本語 / 英語 / その他
2. **併記の有無**: 日英併記が必要か
3. **併記形式**（併記の場合）:
   - タイトル: 日本語（英語）
   - 本文: 日本語のみ or 日英両方

### Markdownでの併記記法

```markdown
# 事業概要 (Business Overview)

**主要目標** / **Key Objectives**
* 売上20%増加 / 20% revenue growth
* 新規市場開拓 / New market expansion
```

### メタデータでの言語指定

```markdown
***
language: "ja"           # 主要言語: ja / en / ja-en
bilingual: true          # 併記有無
bilingual_format: "parenthesis"  # parenthesis / slash / separate_line
***
```

---

## メッセージ設計ルール

**各スライドには必ず「伝えたいメッセージ」を明確に含めてください。**

### スライド構成の原則

```
┌─────────────────────────────────────────┐
│  タイトル（トピック/カテゴリ）            │
├─────────────────────────────────────────┤
│                                         │
│  【メッセージ】← 大きく強調表示           │
│  このスライドで伝えたい核心を1文で        │
│                                         │
├─────────────────────────────────────────┤
│  詳細説明・データ・根拠                  │
│  * 箇条書き1                            │
│  * 箇条書き2                            │
│  * 箇条書き3                            │
└─────────────────────────────────────────┘
```

### メッセージの強調方法

1. **primaryボックスを使用**（推奨）
```markdown
::: box primary
**重要メッセージ**: 売上は前年比150%増加し、過去最高を記録
:::
```

2. **highlightボックスを使用**
```markdown
::: box highlight
**ポイント**: コスト削減と売上増加の両立を実現
:::
```

### メッセージがない場合は作成すること

- 「データを示す」だけでは不十分
- 「このデータから何がわかるか」「だからどうすべきか」を明記

---

## テンプレート選択ガイド（重要）

**単純な箇条書きスライドを避け、状況に応じた高品質なテンプレートを選択してください。**

### スライド内容別の推奨テンプレート

| スライドの内容 | 推奨パターン | templates.md参照 |
|--------------|-------------|-----------------|
| 数値指標・KPI | **KPIダッシュボード** | パターン4 |
| 戦略の3本柱 | **3カラム戦略** | パターン5 |
| 課題と原因分析 | **課題分析フロー** | パターン6 |
| 製品・選択肢の比較 | **比較表** | パターン7 |
| 機能・特徴の説明 | **機能リスト** | パターン8 |
| 投資効果・ROI | **ROIサマリー** | パターン9 |

### 使用すべきテンプレートの判断フロー

```
スライドに数値データがある？
├─ Yes → KPIダッシュボード（パターン4）
└─ No ↓

2つ以上の選択肢を比較している？
├─ Yes → 比較表（パターン7）
└─ No ↓

3つの主要ポイントがある？
├─ Yes → 3カラム戦略（パターン5）
└─ No ↓

原因→結果の関係を説明している？
├─ Yes → 課題分析フロー（パターン6）
└─ No ↓

機能や特徴を列挙している？
├─ Yes → 機能リスト（パターン8）
└─ No → 標準レイアウト（2カラム/シングル）
```

### 表の積極的使用（重要）

**箇条書きで済ませず、構造化できる内容は表にしてください。**

| この内容があれば | 表を使う |
|----------------|---------|
| 2つ以上の選択肢の比較 | ✅ 必須 |
| 数値データの一覧 | ✅ 必須 |
| 項目と説明のペア | ✅ 推奨 |
| 時系列の計画 | ✅ 推奨 |

→ **表のテンプレートは `templates.md` の「表テンプレート」セクション参照**

### 避けるべきパターン

以下のようなスライドは**NG**です：

- ❌ 箇条書きだけの単調なスライド
- ❌ ボックスなしのテキストのみ
- ❌ 数値があるのに表形式を使っていない
- ❌ 比較内容があるのに並列表示していない
- ❌ 項目と説明のペアを箇条書きにしている（表にすべき）

---

## 文字サイズとコンテンツ量

### フォントサイズ階層

| 要素 | サイズ | 用途 |
|-----|--------|-----|
| h1（スライドタイトル） | 44pt | スライドの題目 |
| h2（セクションヘッダー） | 32pt | ボックス内タイトル |
| body（本文） | 24pt | 箇条書き、説明文 |
| small（補足） | 18pt | 注釈、キャプション |

### コンテンツ密度の目安

- **スライド面積の70-80%を使用すること**
- 上下の無駄な空白は避ける
- 情報が少ない場合:
  - 文字を大きくする
  - 画像/図を追加する
  - より詳細な説明を追加する

### 最小コンテンツ量

| レイアウト | 最小項目数 | 備考 |
|-----------|-----------|------|
| シングルカラム | 導入文 + ボックス + 5項目 | 箇条書き最低5つ |
| 2カラム | 各カラム4項目以上 | 合計8項目以上 |
| ヘッダー+2カラム | primary box + 各3項目 | 合計7項目以上 |

---

## 画像・図の扱い

### 画像がある場合

アセットディレクトリから使用するか、パスを指定:

```markdown
![図の説明](../assets/images/diagram.png)
```

### 画像を用意すべき場所

画像がない場合は、プレースホルダーテキストボックスを配置:

```markdown
::: box
**[画像: グラフ/図の説明]**
- 内容: 売上推移の折れ線グラフ
- 色調: 青系統、TOWINGカラーパレット準拠
- データ: 2020-2026年の四半期売上
:::
```

---

## 【重要】環境別ワークフロー

PPTX生成にはPlaywright（ブラウザ自動化ツール）が必要です。
**sandbox環境（Gemini sandbox等）ではPlaywrightが動作しないため、以下のワークフローに従ってください。**

### Sandbox環境の場合（Gemini sandbox等）

```
┌─────────────────────────────────────────────────────────────┐
│  AIアシスタント（sandbox環境）                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Phase 1: outline.md 作成                             │   │
│  │ Phase 2: content.md 作成                             │   │
│  └─────────────────────────────────────────────────────┘   │
│                          ↓                                  │
│  「content.mdの作成が完了しました。                         │
│   ローカル環境で以下のコマンドを実行してください：            │
│                                                             │
│   cd pptx-towing-v3                                         │
│   ./build.sh <project_name>」                               │
└─────────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────────┐
│  ユーザー（ローカル環境）                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ $ cd pptx-towing-v3                                  │   │
│  │ $ ./build.sh <project_name>                          │   │
│  │                                                      │   │
│  │ → Phase 3-4 が自動実行                               │   │
│  │ → output/<project_name>/final.pptx が生成される      │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### ローカル環境の場合（Claude Code等）

Phase 1-4 をすべて同じ環境で実行可能：

```bash
# Phase 1-2: AIがcontent.mdを作成
# Phase 3-4: 以下のコマンドで一括実行
cd pptx-towing-v3
./build.sh <project_name>
```

### build.sh の使い方

```bash
# 基本的な使い方
./build.sh <project_name>

# 例
./build.sh 2026_business_plan
./build.sh investor_pitch

# 利用可能なプロジェクト一覧を表示
./build.sh
```

### AIアシスタントへの指示

**sandbox環境でcontent.md作成が完了したら、必ず以下のメッセージをユーザーに伝えてください：**

```
content.mdの作成が完了しました。

PPTXを生成するには、ローカル環境のターミナルで以下のコマンドを実行してください：

cd /path/to/pptx-towing-v3
./build.sh <project_name>

【重要】sandbox環境でnpm installを実行した場合、node_modulesに互換性がありません。
以下のコマンドで再インストールしてから実行してください：

rm -rf node_modules package-lock.json
npm install
./build.sh <project_name>
```

---

## 実行パイプライン

### Phase 1: Outline生成

```bash
# 作業ディレクトリに移動（またはパスを指定）
# outline.mdを作成

# 内容：
# - 全体のスライド数（10-15枚推奨）
# - 各スライドの役割とlayout
# - key_messageの一覧
```

**必須のスライド構成**:
1. **Slide 1**: タイトルスライド
2. **Slide 2**: アウトラインスライド（必須）← `templates.md`参照
3. **Slide 3以降**: 本編コンテンツ

→ **詳細は `templates.md` を参照**

### Phase 2: Content作成

```bash
# outline.mdをもとにcontent.mdを作成

# 注意点：
# - 各スライドにメッセージを含める
# - コンテンツ密度を確保する
# - 言語指定に従う
```

→ **詳細は `content-guide.md` を参照**

### Phase 3: 中間PPTX生成

```bash
node scripts/generate_from_md.js \
  output/<project_name>/content.md \
  output/<project_name>/intermediate.pptx
```

- 中間HTMLは `output/<project_name>/slides/` に自動生成される
- エラーが出た場合 → **`troubleshooting.md` を参照**

### Phase 4: テンプレート注入

```bash
python3 scripts/inject_slides.py \
  assets/2026TOWINGtemplate.pptx \
  output/<project_name>/intermediate.pptx \
  output/<project_name>/final.pptx
```

---

## 品質チェックリスト（最小版）

### 生成前

- [ ] 専用フォルダを作成したか
- [ ] 言語をユーザーに確認したか
- [ ] 各スライドにメッセージがあるか

### 生成後

- [ ] スライドに空白が多すぎないか
- [ ] 文字サイズは適切か
- [ ] メッセージが強調されているか

→ **詳細なチェックリストは `content-guide.md` を参照**

---

## 禁止事項

- CSS/HTMLの直接記述
- 座標のハードコード
- theme_config.jsonの無断改変
- pptx-towing-v3直下への中間ファイル散乱

---

## 次のステップ

必要に応じて以下のドキュメントを参照してください：

1. **テンプレートが必要な場合** → `docs/templates.md`
2. **コンテンツ設計の詳細** → `docs/content-guide.md`
3. **デザイン調整が必要な場合** → `docs/config-reference.md`
4. **エラーが発生した場合** → `docs/troubleshooting.md`
